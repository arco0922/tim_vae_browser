(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[144],{9996:function(t,n,r){"use strict";r.r(n),r.d(n,{VisualizeAudio:function(){return C}});var e=r(4051),o=r.n(e),a=r(5893),u=r(2230),i=r(7979);function c(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function l(t,n,r,e,o,a,u){try{var i=t[a](u),c=i.value}catch(l){return void r(l)}i.done?n(c):Promise.resolve(c).then(e,o)}function s(t){return function(){var n=this,r=arguments;return new Promise((function(e,o){var a=t.apply(n,r);function u(t){l(a,e,o,u,i,"next",t)}function i(t){l(a,e,o,u,i,"throw",t)}u(void 0)}))}}function f(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,n){if(!t)return;if("string"===typeof t)return c(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(t,n)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var d=1024,p=function(){function t(n,r,e,o){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.running=!1,this.result=null,this.callback=void 0,this.audioContext=n,this.stream=r,this.encoder=e,this.resampleProcesser=null,o&&(this.callback=o)}var n=t.prototype;return n.start=function(){var t=this;return s(o().mark((function n(){var r;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.audioContext.createMediaStreamSource(t.stream),n.next=3,t.audioContext.audioWorklet.addModule((0,i.H)("/worklet-scripts/resample.worklet.js"));case 3:t.resampleProcesser=new AudioWorkletNode(t.audioContext,"resample.worklet"),r.connect(t.resampleProcesser).connect(t.audioContext.destination),t.resampleProcesser.port.onmessage=function(){var n=s(o().mark((function n(r){return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.running){n.next=2;break}return n.abrupt("return");case 2:t.encodeAudio(r.data);case 3:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}();case 6:case"end":return n.stop()}}),n)})))()},n.encodeAudio=function(t){var n=this;return s(o().mark((function r(){var e,a,i;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n.running=!0,r.next=4,u.glt();case 4:if(i=Array.from(t),!(Math.max((e=Math).max.apply(e,f(i)),-(a=Math).min.apply(a,f(i)))<.01)){r.next=9;break}return n.running=!1,r.abrupt("return");case 9:return u.lub((function(){var r=u.RRF(t),e=u.J69(r),o=u.VV$(r),a=u.Fp7(r),i=u.IHx(u.hiC(u.luU(a,o),u.iD$(2)),u.iD$(1e-5)),c=u.hiC(u.luU(r,e),i),l=u.tdS.stft(c,d,1),s=u.XLQ(l,[513]),f=u.hiC(u.WnP(s),u.iD$(d)),p=u.tPi(f,1,512),h=u.XLQ(p,[1,32,16,1]),v=n.encoder.predict([h]),m=u.XLQ(v[1],[2]),y=Array.from(m.dataSync());n.result={coord:y},n.callback&&n.callback({coord:y})})),n.running=!1,r.next=13,u.glt();case 13:case"end":return r.stop()}}),r)})))()},t}(),h=r(7294),v=r(2734),m=r.n(v),y=r(5152);function b(t,n){(null==n||n>t.length)&&(n=t.length);for(var r=0,e=new Array(n);r<n;r++)e[r]=t[r];return e}function w(t,n,r,e,o,a,u){try{var i=t[a](u),c=i.value}catch(l){return void r(l)}i.done?n(c):Promise.resolve(c).then(e,o)}function x(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var r=null==t?null:"undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var e,o,a=[],u=!0,i=!1;try{for(r=r.call(t);!(u=(e=r.next()).done)&&(a.push(e.value),!n||a.length!==n);u=!0);}catch(c){i=!0,o=c}finally{try{u||null==r.return||r.return()}finally{if(i)throw o}}return a}}(t,n)||k(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t){return function(t){if(Array.isArray(t))return b(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||k(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(t,n){if(t){if("string"===typeof t)return b(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(t,n):void 0}}var A=r.n(y)()((function(){return Promise.all([r.e(6),r.e(972)]).then(r.bind(r,6972)).then((function(t){return t.PlotLatentSketch}))}),{loadableGenerated:{webpack:function(){return[6972]}},ssr:!1}),g=2/11,C=function(t){var n=t.audioFilePath,r=t.encoderJSONPath,e=t.title,c=x(h.useState(null),2),l=c[0],s=c[1],f=h.useRef(null),d=x(h.useState(null),2),v=d[0],y=d[1];h.useEffect((function(){if(null===l){AudioContext=window.AudioContext||window.webkitAudioContext;var t=new AudioContext;t.suspend(),s(t)}}),[l]),h.useEffect((function(){if(null!==l&&null!==f.current){var t=f.current,n=t.captureStream?t.captureStream():t.mozCaptureStream?t.mozCaptureStream():null;y(n)}}),[l]);var b=x(h.useState(null),2),k=b[0],C=b[1],_=x(h.useState(null),2),P=_[0],j=_[1],E=x(h.useState([]),2),I=E[0],M=E[1],L=x(h.useState(null),2),N=L[0],R=L[1];h.useEffect((function(){if(null!==l&&null!==v&&null===k){var t=function(){var t,n=(t=o().mark((function t(){var n,e;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.YLj((0,i.H)(r));case 2:n=t.sent,e=new p(l,v,n,j),C(e);case 5:case"end":return t.stop()}}),t)})),function(){var n=this,r=arguments;return new Promise((function(e,o){var a=t.apply(n,r);function u(t){w(a,e,o,u,i,"next",t)}function i(t){w(a,e,o,u,i,"throw",t)}u(void 0)}))});return function(){return n.apply(this,arguments)}}();t()}}),[k,l,v]),h.useEffect((function(){if(null!==P){var t=S(I).concat([P]),n=t.length<=10?t:t.slice(1);M(n)}}),[P]),h.useEffect((function(){var t=I.length;if(0!==t){var n=I[t-1];if(null===N||t<10){for(var r=[],e=0;e<n.coord.length;e++){for(var o=0,a=0;a<t;a++)o+=I[a].coord[e];r.push(o/t)}R({coord:r})}else{var u=N.coord.map((function(t,r){return t*(1-g)+n.coord[r]*g}));R({coord:u})}}}),[I]);var z=x(h.useState(!1),2),H=z[0],V=z[1],$=h.useCallback((function(){H||V(!0)}),[H]),O=x(h.useState(!1),2),J=O[0],T=O[1];h.useEffect((function(){null!==k&&H&&!J&&(k.start(),T(!0))}),[k,H,J]);var U=h.useCallback((function(){null!==l&&l.resume()}),[l]),W=h.useCallback((function(){null!==l&&l.suspend()}),[l]);return(0,a.jsxs)("div",{className:m().container,children:[e&&(0,a.jsx)("h4",{className:m().title,children:e}),(0,a.jsx)("audio",{src:(0,i.H)(n),controls:!0,loop:!0,ref:f,onLoadedMetadata:$,onPlay:U,onPause:W}),(0,a.jsxs)("p",{children:["first: ",null===N||void 0===N?void 0:N.coord[0]]}),(0,a.jsxs)("p",{children:["second: ",null===N||void 0===N?void 0:N.coord[1]]}),(0,a.jsx)(A,{canvasWidth:500,canvasHeight:500,encodeResult:N,className:m().sketch__container})]})}},7979:function(t,n,r){"use strict";r.d(n,{H:function(){return o}});var e=r(1752);function o(t){return(0,e.default)().publicRuntimeConfig.urlPrefix+t}},2734:function(t){t.exports={container:"VisualizeAudio_container__kpLYR",title:"VisualizeAudio_title__1xpJg",sketch__container:"VisualizeAudio_sketch__container__EJsRg"}},5410:function(){},8628:function(){},1601:function(){},7792:function(){},4977:function(){},5042:function(){}}]);