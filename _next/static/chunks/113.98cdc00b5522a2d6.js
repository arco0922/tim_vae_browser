(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[113],{1752:function(n,t,e){n.exports=e(6949)},3241:function(n,t,e){"use strict";e.r(t),e.d(t,{AudioVisualizer:function(){return F}});var r=e(4051),o=e.n(r),i=e(5893),a=e(2230);function u(n,t,e,r,o,i,a){try{var u=n[i](a),c=u.value}catch(s){return void e(s)}u.done?t(c):Promise.resolve(c).then(r,o)}var c=function(){function n(t,e,r,o){!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.isEncoding=!1,this.result=null,this.callback=void 0,this.isFlipped=t,this.encoder=e,this.preprocessor=r,o&&(this.callback=o)}return n.prototype.encodeAudio=function(n){var t,e=this;return(t=o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isEncoding&&null!==n){t.next=2;break}return t.abrupt("return");case 2:return e.isEncoding=!0,t.next=5,a.glt();case 5:return a.lub((function(){var t=e.preprocessor(n),r=e.encoder.predict([t]),o=e.isFlipped?1:0,i=a.XLQ(r[o],[2]),u=Array.from(i.dataSync());e.result={coord:u},e.callback&&e.callback({coord:u})})),e.isEncoding=!1,t.next=9,a.glt();case 9:case"end":return t.stop()}}),t)})),function(){var n=this,e=arguments;return new Promise((function(r,o){var i=t.apply(n,e);function a(n){u(i,r,o,a,c,"next",n)}function c(n){u(i,r,o,a,c,"throw",n)}a(void 0)}))})()},n}(),s=e(7294),l=e(8982),f=e.n(l),d=e(5152),h=e.n(d),v=e(7979),p=e(7941),m=e(2916),_=e(4524),w=e(5952),x=e(1682);var y=function(){function n(t,e,r){!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.shapeFreqs=[],this.durations=[],this.changeDurationMin=t,this.changeDurationMax=e,this.totalDuration=r,this.initShapeFreqsAndDurations()}var t=n.prototype;return t.initShapeFreqsAndDurations=function(){for(var n=0;n<=this.totalDuration;){var t=this.changeDurationMin+Math.random()*(this.changeDurationMax-this.changeDurationMin);this.durations.push(t),n+=t}for(var e=0;e<=this.durations.length;e++){var r=(0,x.V)(),o=(0,w.Z)(r);this.shapeFreqs.push(o)}},t.estimate=function(n){for(var t=0,e=n;e-this.durations[t]>0;)e-=this.durations[t],t+=1;var r=t+1;if(t<0||r>=this.shapeFreqs.length)return null;var o=e/this.durations[t],i=1-o;return this._linearInterpolateVector([i,o],[this.shapeFreqs[t],this.shapeFreqs[r]])},t._linearInterpolateVector=function(n,t){var e=n.length;if(0===e)return[];for(var r=t[0].length,o=new Array(r).fill(0),i=0;i<r;i++)for(var a=0;a<e;a++)o[i]+=n[a]*t[a][i];return o},n}(),g=e(1639);function b(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}function k(n,t,e,r,o,i,a){try{var u=n[i](a),c=u.value}catch(s){return void e(s)}u.done?t(c):Promise.resolve(c).then(r,o)}function S(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function a(n){k(i,r,o,a,u,"next",n)}function u(n){k(i,r,o,a,u,"throw",n)}a(void 0)}))}}function A(n,t){return function(n){if(Array.isArray(n))return n}(n)||function(n,t){var e=null==n?null:"undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=e){var r,o,i=[],a=!0,u=!1;try{for(e=e.call(n);!(a=(r=e.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(c){u=!0,o=c}finally{try{a||null==e.return||e.return()}finally{if(u)throw o}}return i}}(n,t)||j(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(n){return function(n){if(Array.isArray(n))return b(n)}(n)||function(n){if("undefined"!==typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||j(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(n,t){if(n){if("string"===typeof n)return b(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(e):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?b(n,t):void 0}}var N=h()((function(){return e.e(157).then(e.bind(e,9157)).then((function(n){return n.PlotLatentSketch}))}),{loadableGenerated:{webpack:function(){return[9157]}},ssr:!1}),M=h()((function(){return e.e(640).then(e.bind(e,5640)).then((function(n){return n.DrawSamplingPointsSketch}))}),{loadableGenerated:{webpack:function(){return[5640]}},ssr:!1}),C=2/21,D=500,F=function(n){var t=n.useMicrophone,e=void 0!==t&&t,r=n.audioFilePath,u=n.visualizerConfig,l=n.visualizeMode,d=n.annotations,h=n.title,x=n.className,b=A(s.useState(null),2),k=b[0],j=b[1];s.useEffect((function(){if(null===k){window.AudioContext=window.AudioContext||window.webkitAudioContext;var n=new AudioContext;j(n)}}),[]),s.useEffect((function(){return function(){null!==k&&k.close()}}),[k]);var F=s.useRef(null),P=A(s.useState(null),2),z=P[0],V=P[1];s.useEffect((function(){null!==k&&null===F.current&&null===z&&e&&void 0!==navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(n){var t=k.createMediaStreamSource(n);V(t)})).catch((function(n){console.error(n)}))}),[k]),s.useEffect((function(){if(null!==k&&null!==F.current&&null===z&&!e){var n=F.current,t=k.createMediaElementSource(n);V(t)}}),[k]);var H=A(s.useState(null),2),I=H[0],T=H[1];s.useEffect((function(){if(null!==k&&null===I){var n=function(){var n=S(o().mark((function n(){var t;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,k.audioWorklet.addModule("LONG_FAST"===u.encoderMode?(0,v.H)("/worklet-scripts/resample_mel.worklet.js"):(0,v.H)("/worklet-scripts/resample.worklet.js"));case 2:t=new AudioWorkletNode(k,"LONG_FAST"===u.encoderMode?"resample-mel.worklet":"resample.worklet",{parameterData:{bufferSize:u.frameLength,resampleRate:u.samplingRate}}),T(t);case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}}),[k,u]),s.useEffect((function(){null!==k&&null!==z&&null!==I&&(z.connect(I),e||z.connect(k.destination))}),[k,z,I,e]);var L=A(s.useState(null),2),O=L[0],R=L[1],q=A(s.useState(null),2),W=q[0],G=q[1];s.useEffect((function(){var n=function(){var n=S(o().mark((function n(){var t,e;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a.YLj((0,v.H)(u.encoderJSONPath));case 2:t=n.sent,e=new c(u.isFlipped,t,u.encoderPreprocessor,G),R(e);case 5:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}),[u]);var U=A(s.useState(!0),2),Z=U[0],J=U[1];s.useEffect((function(){null!==I&&null!==O&&(I.port.onmessage=function(){var n=S(o().mark((function n(t){return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!==t.data){n.next=3;break}return J(!0),n.abrupt("return");case 3:J(!1),O.encodeAudio(t.data);case 5:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}())}),[I,O]);var B=A(s.useState([]),2),K=B[0],Q=B[1],X=A(s.useState(null),2),Y=X[0],$=X[1];s.useEffect((function(){if(null!==W){var n=E(K).concat([W]),t=n.length<=20?n:n.slice(1);Q(t)}}),[W]),s.useEffect((function(){var n=K.length;if(0!==n){var t=K[n-1];if(null===Y||n<20){for(var e=[],r=0;r<t.coord.length;r++){for(var o=0,i=0;i<n;i++)o+=K[i].coord[r];e.push(o/n)}$({coord:e})}else{var a=Y.coord.map((function(n,e){return n*(1-C)+t.coord[e]*C}));$({coord:a})}}}),[K]);var nn=A(s.useState(!1),2),tn=nn[0],en=nn[1],rn=s.useCallback((function(){en(!0),null!==k&&"running"!==k.state&&k.resume()}),[k]),on=s.useCallback((function(){en(!1),null!==k&&"suspended"!==k.state&&k.suspend()}),[k]),an=A(s.useState(null),2),un=an[0],cn=an[1],sn=A(s.useState(0),2),ln=sn[0],fn=sn[1],dn=A(s.useState(null),2),hn=dn[0],vn=dn[1];s.useEffect((function(){if("SHAPE"===l){var n=new p.f(m.R.inputDim,m.R.outputDim);cn(n)}}),[l]),s.useEffect((function(){if(null!==un&&void 0!==d){var n=0,t=!0,e=!1,r=void 0;try{for(var o,i=Object.entries(d)[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=A(o.value,2),u=a[0],c=a[1],s=u,l=_.gu[s];un.addPoint(l,c),n+=1}}catch(f){e=!0,r=f}finally{try{t||null==i.return||i.return()}finally{if(e)throw r}}fn(n)}}),[d,un]),s.useEffect((function(){if("SHAPE"===l&&null!==un&&null!==Y&&0!==ln){var n=un.estimate(Y.coord),t=(0,w.H)(n);vn(t)}}),[l,Y,un,ln]);var pn=A(s.useState(null),2),mn=pn[0],_n=pn[1],wn=s.useCallback((function(){if("RANDOM"===l&&null!==F.current){var n=F.current,t=new y(1,2,n.duration);_n(t)}}),[l]);return s.useEffect((function(){if("RANDOM"===l&&null!==mn&&null!==Y&&null!==F.current){var n=mn.estimate(F.current.currentTime);if(null!==n){var t=(0,w.H)(n);vn(t)}}}),[l,Y,mn]),(0,i.jsxs)("div",{className:"".concat(f().container," ").concat(x),children:[h&&(0,i.jsx)("h4",{className:f().title,children:h}),void 0!==r&&(0,i.jsx)("audio",{src:(0,v.H)(r),controls:!0,loop:!0,ref:F,preload:"metadata",onClick:rn,onPlay:rn,onPause:on,onLoadedMetadata:wn}),"CHECK"===l&&(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("p",{children:["\u30b9\u30c6\u30fc\u30bf\u30b9\uff1a",null===F.current||F.current.paused?"\u97f3\u3092\u518d\u751f\u3057\u3066\u304f\u3060\u3055\u3044":null===Y?"\u30c6\u30b9\u30c8\u4e2d":NaN===Y.coord[0]?"\u5931\u6557":"\u6210\u529f"]})}),"LATENT"===l&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:f().coord__text,children:[(0,i.jsxs)("p",{children:["first: ",null===Y||void 0===Y?void 0:Y.coord[0]]}),(0,i.jsxs)("p",{children:["second: ",null===Y||void 0===Y?void 0:Y.coord[1]]})]}),(0,i.jsx)(N,{canvasWidth:D,canvasHeight:D,encodeResult:Y,latentImgInfo:u.latentImgInfo,className:f().sketch__container})]}),("SHAPE"===l||"RANDOM"===l)&&(0,i.jsxs)("div",{className:f().sketch__section,children:[Z&&(0,i.jsx)("p",{className:f().silence__text,children:"No sound detected"}),(0,i.jsx)(M,{canvasWidth:D,canvasHeight:D,samplingPoints:hn})]}),e&&(0,i.jsx)("div",{className:f().button__section,children:tn?(0,i.jsx)(g.z,{text:"\u7d42\u4e86",onClick:on}):(0,i.jsx)(g.z,{text:"\u7df4\u7fd2\u958b\u59cb",onClick:rn})})]})}},1682:function(n,t,e){"use strict";e.d(t,{V:function(){return o}});var r=e(4387),o=function(){var n={};return["cornNum","cornAmp","randomness","randomSeed","innerCurve","outerCurve"].forEach((function(t){var e=function(n){var t=n.min,e=n.max,r=n.step,o=Math.floor((e-t)/r);return t+Math.floor(Math.random()*o)*r}(r.e[t].params);n[t]=e})),n}},8982:function(n){n.exports={container:"AudioVisualizer_container__F_TNB",title:"AudioVisualizer_title__NWWgt",coord__text:"AudioVisualizer_coord__text__JklgV",sketch__container:"AudioVisualizer_sketch__container__uaL9G",sketch__section:"AudioVisualizer_sketch__section__9_kl9",silence__text:"AudioVisualizer_silence__text__gZenq",button__section:"AudioVisualizer_button__section__jbI0Z"}}}]);