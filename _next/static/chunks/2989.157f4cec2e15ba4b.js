(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2989],{1752:function(e,t,n){e.exports=n(6949)},2363:function(e,t,n){"use strict";n.r(t),n.d(t,{PracticeAudioVisualizer:function(){return z}});var r=n(4051),i=n.n(r),o=n(5893),a=n(9589),c=n(7294),u=n(2230),s=n(9668),l=n.n(s),d=n(5152),f=n.n(d),p=n(7979),v=n(7941),m=n(2916),_=n(4524),h=n(5952),b=n(1639);function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function x(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(u){c=!0,i=u}finally{try{a||null==n.return||n.return()}finally{if(c)throw i}}return o}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t,n,r,i,o,a){try{var c=e[o](a),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,i)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){k(o,r,i,a,c,"next",e)}function c(e){k(o,r,i,a,c,"throw",e)}a(void 0)}))}}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o=[],a=!0,c=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(u){c=!0,i=u}finally{try{a||null==n.return||n.return()}finally{if(c)throw i}}return o}}(e,t)||A(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e){return function(e){if(Array.isArray(e))return w(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||A(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){if(e){if("string"===typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}var E=f()((function(){return n.e(5640).then(n.bind(n,5640)).then((function(e){return e.DrawSamplingPointsSketch}))}),{loadableGenerated:{webpack:function(){return[5640]}},ssr:!1}),P=f()((function(){return n.e(2267).then(n.bind(n,2267)).then((function(e){return e.DrawPracticeFeedbackSketch}))}),{loadableGenerated:{webpack:function(){return[2267]}},ssr:!1}),C=2/21,N=500,z=function(e){var t=e.practiceConfig,n=e.visualizerConfig,r=e.annotations,s=e.isTrial,d=void 0!==s&&s,f=e.downloadFileName,y=e.duration,w=void 0===y?0:y,k=e.className,A=g(c.useState(null),2),z=A[0],T=A[1];c.useEffect((function(){if(null===z){window.AudioContext=window.AudioContext||window.webkitAudioContext;var e=new AudioContext;T(e)}}),[]);var I=g(c.useState(null),2),H=I[0],V=I[1],F=g(c.useState(null),2),O=F[0],M=F[1],L=c.useRef([]);c.useEffect((function(){null!==z&&null===H&&void 0!==navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(e){var t=z.createMediaStreamSource(e);if(V(t),d){var n=new MediaRecorder(e,{mimeType:"audio/webm"});M(n)}})).catch((function(e){console.error(e)}))}),[z]),c.useEffect((function(){null!==O&&(O.ondataavailable=function(e){var t=e.data,n=L.current;L.current=j(n).concat([t])})}),[O]),c.useEffect((function(){null!==O&&(O.onstop=function(){var e=L.current;if(0!==e.length&&void 0!==f){var t=document.createElement("a");t.href=URL.createObjectURL(new Blob(e)),t.download=f,t.click(),L.current=[]}})}),[O,f]);var R=c.useCallback((function(){null!==O&&O.start()}),[O]),D=c.useCallback((function(){null!==O&&O.stop()}),[O]),U=g(c.useState(null),2),W=U[0],G=U[1];c.useEffect((function(){if(null!==z&&null===W){var e=function(){var e=S(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z.audioWorklet.addModule("LONG_FAST"===n.encoderMode?(0,p.H)("/worklet-scripts/resample_mel.worklet.js"):(0,p.H)("/worklet-scripts/resample.worklet.js"));case 2:t=new AudioWorkletNode(z,"LONG_FAST"===n.encoderMode?"resample-mel.worklet":"resample.worklet",{parameterData:{bufferSize:n.frameLength,resampleRate:n.samplingRate}}),G(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}}),[z,n]),c.useEffect((function(){null!==z&&null!==H&&null!==W&&H.connect(W)}),[z,H,W]);var X=g(c.useState(null),2),q=X[0],B=X[1],Y=g(c.useState(null),2),$=Y[0],J=Y[1];c.useEffect((function(){var e=function(){var e=S(i().mark((function e(){var t,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.YLj((0,p.H)(n.encoderJSONPath));case 2:t=e.sent,r=new a.s(n.isFlipped,t,n.encoderPreprocessor,J),B(r);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[n]);var Q=g(c.useState(!0),2),Z=Q[0],K=Q[1];c.useEffect((function(){null!==W&&null!==q&&(W.port.onmessage=function(){var e=S(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t.data){e.next=3;break}return K(!0),e.abrupt("return");case 3:K(!1),q.encodeAudio(t.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[W,q]);var ee=g(c.useState([]),2),te=ee[0],ne=ee[1],re=g(c.useState(null),2),ie=re[0],oe=re[1];c.useEffect((function(){if(null!==$){var e=j(te).concat([$]),t=e.length<=20?e:e.slice(1);ne(t)}}),[$]),c.useEffect((function(){var e=te.length;if(0!==e){var t=te[e-1];if(null===ie||e<20){for(var n=[],r=0;r<t.coord.length;r++){for(var i=0,o=0;o<e;o++)i+=te[o].coord[r];n.push(i/e)}oe({coord:n})}else{var a=ie.coord.map((function(e,n){return e*(1-C)+t.coord[n]*C}));oe({coord:a})}}}),[te]);var ae=g(c.useState(!1),2),ce=ae[0],ue=ae[1],se=c.useCallback((function(){ue(!0),null!==z&&"running"!==z.state&&z.resume()}),[z]),le=c.useCallback((function(){ue(!1),null!==z&&"suspended"!==z.state&&z.suspend()}),[z]),de=g(c.useState(null),2),fe=de[0],pe=de[1],ve=g(c.useState(0),2),me=ve[0],_e=ve[1],he=g(c.useState(null),2),be=he[0],ye=he[1];c.useEffect((function(){if("SHAPE"===t.mode){var e=new v.f(m.R.inputDim,m.R.outputDim);pe(e)}}),[t.mode]),c.useEffect((function(){if(null!==fe&&void 0!==r){var e=0,t=!0,n=!1,i=void 0;try{for(var o,a=Object.entries(r)[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var c=g(o.value,2),u=c[0],s=c[1],l=u,d=_.gu[l];fe.addPoint(d,s),e+=1}}catch(f){n=!0,i=f}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}_e(e)}}),[r,fe]),c.useEffect((function(){if("SHAPE"===t.mode&&null!==fe&&null!==ie&&0!==me){var e=fe.estimate(ie.coord),n=(0,h.H)(e);ye(n)}}),[t.mode,ie,fe,me]);var xe=g(c.useState(null),2),we=xe[0],ke=xe[1];c.useEffect((function(){if("SHAPE"===t.mode&&null!==fe&&0!==me){var e=fe.estimate(t.goalInfo.coord),n=(0,h.H)(e);ke(n)}}),[t,fe,me]);var Se=function(){var e=x(c.useState(0),2),t=e[0],n=e[1],r=x(c.useState(0),2),i=r[0],o=r[1],a=x(c.useState(!1),2),u=a[0],s=a[1],l=x(c.useState(void 0),2),d=l[0],f=l[1],p=c.useCallback((function(e,t){n(Math.floor(e/60)),o(e-60*Math.floor(e/60)),s(!0),f((function(){return t}))}),[]),v=c.useCallback((function(){s(!0)}),[]),m=c.useCallback((function(){s(!1)}),[]),_=c.useCallback((function(){s(!1),n(0),o(0),void 0!==d&&d()}),[d]);return c.useEffect((function(){if(u){0===t&&0===i&&void 0!==d&&d();var e=setInterval((function(){i>0&&o(i-1),0===i&&(0===t?clearInterval(e):(n(t-1),o(59)))}),1e3);return function(){clearInterval(e)}}}),[u,t,i,d]),{minutes:t,seconds:i,startTimer:p,resumeTimer:v,stopTimer:m,finishTimer:_}}(),ge=Se.minutes,je=Se.seconds,Ae=Se.startTimer,Ee=Se.finishTimer,Pe=c.useCallback((function(){le(),d&&D()}),[le,d,D]),Ce=c.useCallback((function(){w>0?Ee():Pe()}),[w,Ee,Pe]),Ne=c.useCallback((function(){se(),d&&R(),w>0&&Ae(w,Pe)}),[se,d,R,w,Ae,Pe]);return(0,o.jsxs)("div",{className:"".concat(l().container," ").concat(k),children:["SOUND"===t.mode&&(0,o.jsxs)("div",{className:l().sound__only,children:[ce&&!(0===ge&&0===je)&&(0,o.jsxs)("p",{children:["\u6b8b\u308a\u6642\u9593\uff1a",ge,":",je<10?"0".concat(je):je]}),!(d&&ce)&&(0,o.jsxs)("div",{className:l().sound__part,children:[(0,o.jsx)("p",{children:"\u76ee\u6a19\u97f3"}),(0,o.jsx)("audio",{src:(0,p.H)(t.goalInfo.audioFilePath),controls:!0,loop:!0,preload:"metadata"})]}),(0,o.jsx)("div",{className:l().button__part,children:ce?(0,o.jsx)(b.z,{text:d?"\u9332\u97f3\u7d42\u4e86":"\u7df4\u7fd2\u7d42\u4e86",onClick:Ce}):(0,o.jsx)(b.z,{text:d?"\u9332\u97f3\u958b\u59cb":"\u7df4\u7fd2\u958b\u59cb",onClick:Ne})})]}),"SHAPE"===t.mode&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:l().ref__section,children:[(0,o.jsx)("div",{className:l().top__section,children:!(d&&ce)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("p",{children:"\u76ee\u6a19\u97f3"}),(0,o.jsx)("audio",{src:(0,p.H)(t.goalInfo.audioFilePath),controls:!0,loop:!0,preload:"metadata"})]})}),(0,o.jsxs)("div",{className:l().middle__section,children:[(0,o.jsx)("p",{children:"\u76ee\u6a19\u56f3\u5f62"}),(0,o.jsx)("div",{className:l().ref__sketch,children:(0,o.jsx)(E,{canvasWidth:N,canvasHeight:N,samplingPoints:we})})]}),(0,o.jsx)("div",{className:l().bottom__section})]}),(0,o.jsxs)("div",{className:l().feedback__section,children:[(0,o.jsx)("div",{className:l().top__section,children:!(0===ge&&0===je)&&(0,o.jsxs)("p",{children:["\u6b8b\u308a\u6642\u9593\uff1a",ge,":",je<10?"0".concat(je):je]})}),(0,o.jsxs)("div",{className:l().middle__section,children:[(0,o.jsx)("p",{children:"\u73fe\u72b6\u306e\u56f3\u5f62(\u8d64\u7dda)"}),(0,o.jsxs)("div",{className:l().practice__sketch,children:[ce?(0,o.jsx)(o.Fragment,{children:Z&&(0,o.jsx)("p",{className:l().silence__text,children:"No sound detected"})}):(0,o.jsx)(b.z,{text:d?"\u9332\u97f3\u958b\u59cb":"\u7df4\u7fd2\u958b\u59cb",onClick:Ne}),(0,o.jsx)(P,{canvasWidth:N,canvasHeight:N,samplingPoints:be,goalSamplingPoints:we,hidePoints:!ce||Z})]})]}),(0,o.jsx)("div",{className:l().bottom__section,children:ce&&(0,o.jsx)(b.z,{text:d?"\u9332\u97f3\u7d42\u4e86":"\u7df4\u7fd2\u7d42\u4e86",onClick:Ce})})]})]})]})}},9589:function(e,t,n){"use strict";n.d(t,{s:function(){return c}});var r=n(4051),i=n.n(r),o=n(2230);function a(e,t,n,r,i,o,a){try{var c=e[o](a),u=c.value}catch(s){return void n(s)}c.done?t(u):Promise.resolve(u).then(r,i)}var c=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isEncoding=!1,this.result=null,this.callback=void 0,this.isFlipped=t,this.encoder=n,this.preprocessor=r,i&&(this.callback=i)}return e.prototype.encodeAudio=function(e){var t,n=this;return(t=i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.isEncoding&&null!==e){t.next=2;break}return t.abrupt("return");case 2:return n.isEncoding=!0,t.next=5,o.glt();case 5:return o.lub((function(){var t=n.preprocessor(e),r=n.encoder.predict([t]),i=n.isFlipped?1:0,a=o.XLQ(r[i],[2]),c=Array.from(a.dataSync());n.result={coord:c},n.callback&&n.callback({coord:c})})),n.isEncoding=!1,t.next=9,o.glt();case 9:case"end":return t.stop()}}),t)})),function(){var e=this,n=arguments;return new Promise((function(r,i){var o=t.apply(e,n);function c(e){a(o,r,i,c,u,"next",e)}function u(e){a(o,r,i,c,u,"throw",e)}c(void 0)}))})()},e}()},9668:function(e){e.exports={container:"PracticeAudioVisualizer_container__YTEE7",sound__only:"PracticeAudioVisualizer_sound__only__R3tpW",button__part:"PracticeAudioVisualizer_button__part__4BaL1",ref__section:"PracticeAudioVisualizer_ref__section__4Ob47",feedback__section:"PracticeAudioVisualizer_feedback__section__y_5E2",top__section:"PracticeAudioVisualizer_top__section__Wx81Z",middle__section:"PracticeAudioVisualizer_middle__section__qqtXT",bottom__section:"PracticeAudioVisualizer_bottom__section__8NU80",practice__sketch:"PracticeAudioVisualizer_practice__sketch__uiomV",silence__text:"PracticeAudioVisualizer_silence__text__XhCP2",button__section:"PracticeAudioVisualizer_button__section__mLOz_"}}}]);