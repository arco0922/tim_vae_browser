(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2264],{1752:function(n,e,t){n.exports=t(6949)},2264:function(n,e,t){"use strict";t.r(e),t.d(e,{AudioVisualizer:function(){return D}});var r=t(4051),a=t.n(r),i=t(5893),o=t(9589),u=t(7294),s=t(2230),c=t(8982),l=t.n(c),f=t(5152),d=t.n(f),h=t(7979),p=t(7941),v=t(2916),m=t(4524),_=t(5952),x=t(1682);var b=function(){function n(e,t,r){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.shapeFreqs=[],this.durations=[],this.changeDurationMin=e,this.changeDurationMax=t,this.totalDuration=r,this.initShapeFreqsAndDurations()}var e=n.prototype;return e.initShapeFreqsAndDurations=function(){for(var n=0;n<=this.totalDuration;){var e=this.changeDurationMin+Math.random()*(this.changeDurationMax-this.changeDurationMin);this.durations.push(e),n+=e}for(var t=0;t<=this.durations.length;t++){var r=(0,x.V)(),a=(0,_.Z)(r);this.shapeFreqs.push(a)}},e.estimate=function(n){for(var e=0,t=n;t-this.durations[e]>0;)t-=this.durations[e],e+=1;var r=e+1;if(e<0||r>=this.shapeFreqs.length)return null;var a=t/this.durations[e],i=1-a;return this._linearInterpolateVector([i,a],[this.shapeFreqs[e],this.shapeFreqs[r]])},e._linearInterpolateVector=function(n,e){var t=n.length;if(0===t)return[];for(var r=e[0].length,a=new Array(r).fill(0),i=0;i<r;i++)for(var o=0;o<t;o++)a[i]+=n[o]*e[o][i];return a},n}(),g=t(1639);function w(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function y(n,e,t,r,a,i,o){try{var u=n[i](o),s=u.value}catch(c){return void t(c)}u.done?e(s):Promise.resolve(s).then(r,a)}function k(n){return function(){var e=this,t=arguments;return new Promise((function(r,a){var i=n.apply(e,t);function o(n){y(i,r,a,o,u,"next",n)}function u(n){y(i,r,a,o,u,"throw",n)}o(void 0)}))}}function S(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=null==n?null:"undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=t){var r,a,i=[],o=!0,u=!1;try{for(t=t.call(n);!(o=(r=t.next()).done)&&(i.push(r.value),!e||i.length!==e);o=!0);}catch(s){u=!0,a=s}finally{try{o||null==t.return||t.return()}finally{if(u)throw a}}return i}}(n,e)||E(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(n){return function(n){if(Array.isArray(n))return w(n)}(n)||function(n){if("undefined"!==typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||E(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(n,e){if(n){if("string"===typeof n)return w(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?w(n,e):void 0}}var j=d()((function(){return t.e(9157).then(t.bind(t,9157)).then((function(n){return n.PlotLatentSketch}))}),{loadableGenerated:{webpack:function(){return[9157]}},ssr:!1}),N=d()((function(){return t.e(5640).then(t.bind(t,5640)).then((function(n){return n.DrawSamplingPointsSketch}))}),{loadableGenerated:{webpack:function(){return[5640]}},ssr:!1}),C=2/21,M=500,D=function(n){var e=n.useMicrophone,t=void 0!==e&&e,r=n.audioFilePath,c=n.visualizerConfig,f=n.visualizeMode,d=n.annotations,x=n.title,w=n.className,y=S(u.useState(null),2),E=y[0],D=y[1];u.useEffect((function(){if(null===E){window.AudioContext=window.AudioContext||window.webkitAudioContext;var n=new AudioContext({sampleRate:c.samplingRate});D(n)}}),[c.samplingRate]);var P=u.useRef(null),F=S(u.useState(null),2),I=F[0],z=F[1];u.useEffect((function(){null!==E&&null===P.current&&null===I&&t&&void 0!==navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(n){var e=E.createMediaStreamSource(n);z(e)})).catch((function(n){console.error(n)}))}),[E]),u.useEffect((function(){if(null!==E&&null!==P.current&&null===I&&!t){var n=P.current,e=E.createMediaElementSource(n);z(e)}}),[E]);var H=S(u.useState(null),2),R=H[0],V=H[1];u.useEffect((function(){if(null!==E&&null===R){var n=function(){var n=k(a().mark((function n(){var e;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,E.audioWorklet.addModule("LONG_FAST"===c.encoderMode?(0,h.H)("/worklet-scripts/resample_mel.worklet.js"):(0,h.H)("/worklet-scripts/resample.worklet.js"));case 2:e=new AudioWorkletNode(E,"LONG_FAST"===c.encoderMode?"resample-mel.worklet":"resample.worklet",{parameterData:{bufferSize:c.frameLength,resampleRate:c.samplingRate}}),V(e);case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}}),[E,c]),u.useEffect((function(){null!==E&&null!==I&&null!==R&&(I.connect(R),t||I.connect(E.destination))}),[E,I,R,t]);var T=S(u.useState(null),2),L=T[0],O=T[1],q=S(u.useState(null),2),W=q[0],G=q[1];u.useEffect((function(){var n=function(){var n=k(a().mark((function n(){var e,t;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.YLj((0,h.H)(c.encoderJSONPath));case 2:e=n.sent,t=new o.s(c.isFlipped,e,c.encoderPreprocessor,G),O(t);case 5:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}),[c]);var Z=S(u.useState(!0),2),U=Z[0],J=Z[1];u.useEffect((function(){null!==R&&null!==L&&(R.port.onmessage=function(){var n=k(a().mark((function n(e){return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!==e.data){n.next=3;break}return J(!0),n.abrupt("return");case 3:J(!1),L.encodeAudio(e.data);case 5:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}),[R,L]);var B=S(u.useState([]),2),K=B[0],Q=B[1],X=S(u.useState(null),2),Y=X[0],$=X[1];u.useEffect((function(){if(null!==W){var n=A(K).concat([W]),e=n.length<=20?n:n.slice(1);Q(e)}}),[W]),u.useEffect((function(){var n=K.length;if(0!==n){var e=K[n-1];if(null===Y||n<20){for(var t=[],r=0;r<e.coord.length;r++){for(var a=0,i=0;i<n;i++)a+=K[i].coord[r];t.push(a/n)}$({coord:t})}else{var o=Y.coord.map((function(n,t){return n*(1-C)+e.coord[t]*C}));$({coord:o})}}}),[K]);var nn=S(u.useState(!1),2),en=nn[0],tn=nn[1],rn=u.useCallback((function(){tn(!0),null!==E&&"running"!==E.state&&E.resume()}),[E]),an=u.useCallback((function(){tn(!1),null!==E&&"suspended"!==E.state&&E.suspend()}),[E]),on=S(u.useState(null),2),un=on[0],sn=on[1],cn=S(u.useState(0),2),ln=cn[0],fn=cn[1],dn=S(u.useState(null),2),hn=dn[0],pn=dn[1];u.useEffect((function(){if("SHAPE"===f){var n=new p.f(v.R.inputDim,v.R.outputDim);sn(n)}}),[f]),u.useEffect((function(){if(null!==un&&void 0!==d){var n=m.lZ[c.encoderId];if(void 0!==n){var e=0,t=!0,r=!1,a=void 0;try{for(var i,o=Object.entries(d)[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var u=S(i.value,2),s=u[0],l=u[1],f=n[s];un.addPoint(f,l),e+=1}}catch(h){r=!0,a=h}finally{try{t||null==o.return||o.return()}finally{if(r)throw a}}fn(e)}}}),[c.encoderId,d,un]),u.useEffect((function(){if("SHAPE"===f&&null!==un&&null!==Y&&0!==ln){var n=un.estimate(Y.coord),e=(0,_.H)(n);pn(e)}}),[f,Y,un,ln]);var vn=S(u.useState(null),2),mn=vn[0],_n=vn[1],xn=u.useCallback((function(){if("RANDOM"===f&&null!==P.current){var n=P.current,e=new b(1,2,n.duration);_n(e)}}),[f]);return u.useEffect((function(){if("RANDOM"===f&&null!==mn&&null!==Y&&null!==P.current){var n=mn.estimate(P.current.currentTime);if(null!==n){var e=(0,_.H)(n);pn(e)}}}),[f,Y,mn]),(0,i.jsxs)("div",{className:"".concat(l().container," ").concat(w),children:[x&&(0,i.jsx)("h4",{className:l().title,children:x}),void 0!==r&&(0,i.jsx)("audio",{src:(0,h.H)(r),controls:!0,loop:!0,ref:P,preload:"metadata",onClick:rn,onPlay:rn,onPause:an,onLoadedMetadata:xn}),"CHECK"===f&&(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("p",{children:["\u30b9\u30c6\u30fc\u30bf\u30b9\uff1a",null===P.current||P.current.paused?"\u97f3\u3092\u518d\u751f\u3057\u3066\u304f\u3060\u3055\u3044":null===Y?"\u30c6\u30b9\u30c8\u4e2d":NaN===Y.coord[0]?"\u5931\u6557":"\u6210\u529f"]})}),"LATENT"===f&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:l().coord__text,children:[(0,i.jsxs)("p",{children:["first: ",null===Y||void 0===Y?void 0:Y.coord[0]]}),(0,i.jsxs)("p",{children:["second: ",null===Y||void 0===Y?void 0:Y.coord[1]]})]}),(0,i.jsx)(j,{canvasWidth:M,canvasHeight:M,encodeResult:Y,latentImgInfo:c.latentImgInfo,className:l().sketch__container})]}),("SHAPE"===f||"RANDOM"===f)&&(0,i.jsxs)("div",{className:l().sketch__section,children:[U&&(0,i.jsx)("p",{className:l().silence__text,children:"No sound detected"}),(0,i.jsx)(N,{canvasWidth:M,canvasHeight:M,samplingPoints:hn})]}),t&&(0,i.jsx)("div",{className:l().button__section,children:en?(0,i.jsx)(g.z,{text:"\u7d42\u4e86",onClick:an}):(0,i.jsx)(g.z,{text:"\u7df4\u7fd2\u958b\u59cb",onClick:rn})})]})}},4387:function(n,e,t){"use strict";t.d(e,{e:function(){return r}});var r={cornNum:{label:"\u30c4\u30ce\u306e\u672c\u6570",params:{min:5,max:30,step:1}},cornAmp:{label:"\u30c4\u30ce\u306e\u9577\u3055",params:{min:0,max:.5,step:.01}},randomness:{label:"\u30e9\u30f3\u30c0\u30e0\u306e\u5ea6\u5408\u3044",params:{min:0,max:1,step:.01}},randomSeed:{label:"\u30e9\u30f3\u30c0\u30e0\u306e\u3055\u305b\u65b9",params:{min:1,max:20,step:1}},innerCurve:{label:"\u30c4\u30ce\u306e\u6839\u5143\u306e\u4e38\u3055",params:{min:0,max:1,step:.01}},outerCurve:{label:"\u30c4\u30ce\u306e\u5148\u7aef\u306e\u4e38\u3055",params:{min:0,max:1,step:.01}}}},9589:function(n,e,t){"use strict";t.d(e,{s:function(){return u}});var r=t(4051),a=t.n(r),i=t(2230);function o(n,e,t,r,a,i,o){try{var u=n[i](o),s=u.value}catch(c){return void t(c)}u.done?e(s):Promise.resolve(s).then(r,a)}var u=function(){function n(e,t,r,a){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.isEncoding=!1,this.result=null,this.callback=void 0,this.isFlipped=e,this.encoder=t,this.preprocessor=r,a&&(this.callback=a)}return n.prototype.encodeAudio=function(n){var e,t=this;return(e=a().mark((function e(){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isEncoding&&null!==n){e.next=2;break}return e.abrupt("return");case 2:return t.isEncoding=!0,e.next=5,i.glt();case 5:return i.lub((function(){var e=t.preprocessor(n),r=t.encoder.predict([e]),a=t.isFlipped?1:0,o=i.XLQ(r[a],[2]),u=Array.from(o.dataSync());t.result={coord:u},t.callback&&t.callback({coord:u})})),t.isEncoding=!1,e.next=9,i.glt();case 9:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,a){var i=e.apply(n,t);function u(n){o(i,r,a,u,s,"next",n)}function s(n){o(i,r,a,u,s,"throw",n)}u(void 0)}))})()},n}()},1682:function(n,e,t){"use strict";t.d(e,{V:function(){return a}});var r=t(4387),a=function(){var n={};return["cornNum","cornAmp","randomness","randomSeed","innerCurve","outerCurve"].forEach((function(e){var t=function(n){var e=n.min,t=n.max,r=n.step,a=Math.floor((t-e)/r);return e+Math.floor(Math.random()*a)*r}(r.e[e].params);n[e]=t})),n}},7979:function(n,e,t){"use strict";t.d(e,{H:function(){return a}});var r=t(1752);function a(n){return(0,r.default)().publicRuntimeConfig.urlPrefix+n}},8982:function(n){n.exports={container:"AudioVisualizer_container__F_TNB",title:"AudioVisualizer_title__NWWgt",coord__text:"AudioVisualizer_coord__text__JklgV",sketch__container:"AudioVisualizer_sketch__container__uaL9G",sketch__section:"AudioVisualizer_sketch__section__9_kl9",silence__text:"AudioVisualizer_silence__text__gZenq",button__section:"AudioVisualizer_button__section__jbI0Z"}}}]);