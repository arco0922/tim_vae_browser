(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[113],{1752:function(n,t,e){n.exports=e(6949)},3241:function(n,t,e){"use strict";e.r(t),e.d(t,{AudioVisualizer:function(){return F}});var r=e(4051),o=e.n(r),a=e(5893),i=e(2230);function u(n,t,e,r,o,a,i){try{var u=n[a](i),c=u.value}catch(s){return void e(s)}u.done?t(c):Promise.resolve(c).then(r,o)}var c=function(){function n(t,e,r,o){!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.isEncoding=!1,this.result=null,this.callback=void 0,this.isFlipped=t,this.encoder=e,this.preprocessor=r,o&&(this.callback=o)}return n.prototype.encodeAudio=function(n){var t,e=this;return(t=o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isEncoding&&null!==n){t.next=2;break}return t.abrupt("return");case 2:return e.isEncoding=!0,t.next=5,i.glt();case 5:return i.lub((function(){var t=e.preprocessor(n),r=e.encoder.predict([t]),o=e.isFlipped?1:0,a=i.XLQ(r[o],[2]),u=Array.from(a.dataSync());e.result={coord:u},e.callback&&e.callback({coord:u})})),e.isEncoding=!1,t.next=9,i.glt();case 9:case"end":return t.stop()}}),t)})),function(){var n=this,e=arguments;return new Promise((function(r,o){var a=t.apply(n,e);function i(n){u(a,r,o,i,c,"next",n)}function c(n){u(a,r,o,i,c,"throw",n)}i(void 0)}))})()},n}(),s=e(7294),l=e(8982),f=e.n(l),d=e(5152),h=e.n(d),p=e(7979),v=e(7941),m=e(2916),w=e(4524),y=e(5952),g=e(1682);var b=function(){function n(t,e,r){!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.shapeFreqs=[],this.durations=[],this.changeDurationMin=t,this.changeDurationMax=e,this.totalDuration=r,this.initShapeFreqsAndDurations()}var t=n.prototype;return t.initShapeFreqsAndDurations=function(){for(var n=0;n<=this.totalDuration;){var t=this.changeDurationMin+Math.random()*(this.changeDurationMax-this.changeDurationMin);this.durations.push(t),n+=t}for(var e=0;e<=this.durations.length;e++){var r=(0,g.V)(),o=(0,y.Z)(r);this.shapeFreqs.push(o)}},t.estimate=function(n){for(var t=0,e=n;e-this.durations[t]>0;)e-=this.durations[t],t+=1;var r=t+1;if(t<0||r>=this.shapeFreqs.length)return null;var o=e/this.durations[t],a=1-o;return this._linearInterpolateVector([a,o],[this.shapeFreqs[t],this.shapeFreqs[r]])},t._linearInterpolateVector=function(n,t){var e=n.length;if(0===e)return[];for(var r=t[0].length,o=new Array(r).fill(0),a=0;a<r;a++)for(var i=0;i<e;i++)o[a]+=n[i]*t[i][a];return o},n}();function x(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}function A(n,t,e,r,o,a,i){try{var u=n[a](i),c=u.value}catch(s){return void e(s)}u.done?t(c):Promise.resolve(c).then(r,o)}function S(n){return function(){var t=this,e=arguments;return new Promise((function(r,o){var a=n.apply(t,e);function i(n){A(a,r,o,i,u,"next",n)}function u(n){A(a,r,o,i,u,"throw",n)}i(void 0)}))}}function k(n,t){return function(n){if(Array.isArray(n))return n}(n)||function(n,t){var e=null==n?null:"undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=e){var r,o,a=[],i=!0,u=!1;try{for(e=e.call(n);!(i=(r=e.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(c){u=!0,o=c}finally{try{i||null==e.return||e.return()}finally{if(u)throw o}}return a}}(n,t)||E(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(n){return function(n){if(Array.isArray(n))return x(n)}(n)||function(n){if("undefined"!==typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||E(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(n,t){if(n){if("string"===typeof n)return x(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);return"Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e?Array.from(e):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?x(n,t):void 0}}var j=h()((function(){return e.e(157).then(e.bind(e,9157)).then((function(n){return n.PlotLatentSketch}))}),{loadableGenerated:{webpack:function(){return[9157]}},ssr:!1}),N=h()((function(){return e.e(640).then(e.bind(e,5640)).then((function(n){return n.DrawSamplingPointsSketch}))}),{loadableGenerated:{webpack:function(){return[5640]}},ssr:!1}),M=2/21,C=500,F=function(n){var t=n.audioFilePath,e=n.visualizerConfig,r=n.visualizeMode,u=n.annotations,l=n.title,d=n.className,h=k(s.useState(null),2),g=h[0],x=h[1];s.useEffect((function(){if(null===g){window.AudioContext=window.AudioContext||window.webkitAudioContext;var n=new AudioContext;x(n)}}),[]);var A=s.useRef(null),E=k(s.useState(null),2),F=E[0],D=E[1];s.useEffect((function(){if(null!==g&&null!==A.current&&null===F){var n=A.current,t=g.createMediaElementSource(n);D(t)}}),[g]);var P=k(s.useState(null),2),H=P[0],I=P[1];s.useEffect((function(){if(null!==g&&null===H){var n=function(){var n=S(o().mark((function n(){var t;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,g.audioWorklet.addModule("LONG_FAST"===e.encoderMode?(0,p.H)("/worklet-scripts/resample_mel.worklet.js"):(0,p.H)("/worklet-scripts/resample.worklet.js"));case 2:t=new AudioWorkletNode(g,"LONG_FAST"===e.encoderMode?"resample-mel.worklet":"resample.worklet",{parameterData:{bufferSize:e.frameLength,resampleRate:e.samplingRate}}),I(t);case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}}),[g,e]),s.useEffect((function(){null!==g&&null!==F&&null!==H&&(F.connect(H),F.connect(g.destination))}),[g,F,H]);var T=k(s.useState(null),2),V=T[0],L=T[1],O=k(s.useState(null),2),R=O[0],z=O[1];s.useEffect((function(){var n=function(){var n=S(o().mark((function n(){var t,r;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.YLj((0,p.H)(e.encoderJSONPath));case 2:t=n.sent,r=new c(e.isFlipped,t,e.encoderPreprocessor,z),L(r);case 5:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}),[e]),s.useEffect((function(){null!==H&&null!==V&&(H.port.onmessage=function(){var n=S(o().mark((function n(t){return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:V.encodeAudio(t.data);case 1:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}())}),[H,V]);var q=k(s.useState([]),2),W=q[0],G=q[1],J=k(s.useState(null),2),B=J[0],K=J[1];s.useEffect((function(){if(null!==R){var n=_(W).concat([R]),t=n.length<=20?n:n.slice(1);G(t)}}),[R]),s.useEffect((function(){var n=W.length;if(0!==n){var t=W[n-1];if(null===B||n<20){for(var e=[],r=0;r<t.coord.length;r++){for(var o=0,a=0;a<n;a++)o+=W[a].coord[r];e.push(o/n)}K({coord:e})}else{var i=B.coord.map((function(n,e){return n*(1-M)+t.coord[e]*M}));K({coord:i})}}}),[W]);var Q=s.useCallback((function(){null!==g&&"running"!==g.state&&g.resume()}),[g]),U=s.useCallback((function(){null!==g&&"suspended"!==g.state&&g.suspend()}),[g]),X=k(s.useState(null),2),Y=X[0],Z=X[1],$=k(s.useState(0),2),nn=$[0],tn=$[1],en=k(s.useState(null),2),rn=en[0],on=en[1];s.useEffect((function(){if("SHAPE"===r){var n=new v.f(m.R.inputDim,m.R.outputDim);Z(n)}}),[r]),s.useEffect((function(){if(null!==Y&&void 0!==u){var n=0,t=!0,e=!1,r=void 0;try{for(var o,a=Object.entries(u)[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){var i=k(o.value,2),c=i[0],s=i[1],l=c,f=w.g[l];Y.addPoint(f,s),n+=1}}catch(d){e=!0,r=d}finally{try{t||null==a.return||a.return()}finally{if(e)throw r}}tn(n)}}),[u,Y]),s.useEffect((function(){if("SHAPE"===r&&null!==Y&&null!==B&&0!==nn){var n=Y.estimate(B.coord),t=(0,y.H)(n);on(t)}}),[r,B,Y,nn]);var an=k(s.useState(null),2),un=an[0],cn=an[1],sn=s.useCallback((function(){if("RANDOM"===r&&null!==A.current){var n=A.current,t=new b(1,2,n.duration);cn(t)}}),[r]);return s.useEffect((function(){if("RANDOM"===r&&null!==un&&null!==B&&null!==A.current){var n=un.estimate(A.current.currentTime);if(null!==n){var t=(0,y.H)(n);on(t)}}}),[r,B,un]),(0,a.jsxs)("div",{className:"".concat(f().container," ").concat(d),children:[l&&(0,a.jsx)("h4",{className:f().title,children:l}),(0,a.jsx)("audio",{src:(0,p.H)(t),controls:!0,loop:!0,ref:A,preload:"metadata",onClick:Q,onPlay:Q,onPause:U,onLoadedMetadata:sn}),"CHECK"===r&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("p",{children:["\u30b9\u30c6\u30fc\u30bf\u30b9\uff1a",null===A.current||A.current.paused?"\u97f3\u3092\u518d\u751f\u3057\u3066\u304f\u3060\u3055\u3044":null===B?"\u30c6\u30b9\u30c8\u4e2d":NaN===B.coord[0]?"\u5931\u6557":"\u6210\u529f"]})}),"LATENT"===r&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:f().coord__text,children:[(0,a.jsxs)("p",{children:["first: ",null===B||void 0===B?void 0:B.coord[0]]}),(0,a.jsxs)("p",{children:["second: ",null===B||void 0===B?void 0:B.coord[1]]})]}),(0,a.jsx)(j,{canvasWidth:C,canvasHeight:C,encodeResult:B,latentImgInfo:e.latentImgInfo,className:f().sketch__container})]}),("SHAPE"===r||"RANDOM"===r)&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(N,{canvasWidth:C,canvasHeight:C,samplingPoints:rn})})]})}},1682:function(n,t,e){"use strict";e.d(t,{V:function(){return o}});var r=e(4387),o=function(){var n={};return["cornNum","cornAmp","randomness","randomSeed","innerCurve","outerCurve"].forEach((function(t){var e=function(n){var t=n.min,e=n.max,r=n.step,o=Math.floor((e-t)/r);return t+Math.floor(Math.random()*o)*r}(r.e[t].params);n[t]=e})),n}},8982:function(n){n.exports={container:"AudioVisualizer_container__F_TNB",title:"AudioVisualizer_title__NWWgt",coord__text:"AudioVisualizer_coord__text__JklgV",sketch__container:"AudioVisualizer_sketch__container__uaL9G"}}}]);