(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[706],{1752:function(n,e,t){n.exports=t(6949)},8706:function(n,e,t){"use strict";t.r(e),t.d(e,{AudioVisualizer:function(){return A}});var r=t(4051),o=t.n(r),u=t(5893),i=t(2230);function a(n,e,t,r,o,u,i){try{var a=n[u](i),c=a.value}catch(l){return void t(l)}a.done?e(c):Promise.resolve(c).then(r,o)}var c=function(){function n(e,t,r,o){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),this.isEncoding=!1,this.result=null,this.callback=void 0,this.isFlipped=e,this.encoder=t,this.preprocessor=r,o&&(this.callback=o)}return n.prototype.encodeAudio=function(n){var e,t=this;return(e=o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isEncoding&&null!==n){e.next=2;break}return e.abrupt("return");case 2:return t.isEncoding=!0,e.next=5,i.glt();case 5:return i.lub((function(){var e=t.preprocessor(n),r=t.encoder.predict([e]),o=t.isFlipped?1:0,u=i.XLQ(r[o],[2]),a=Array.from(u.dataSync());t.result={coord:a},t.callback&&t.callback({coord:a})})),t.isEncoding=!1,e.next=9,i.glt();case 9:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,o){var u=e.apply(n,t);function i(n){a(u,r,o,i,c,"next",n)}function c(n){a(u,r,o,i,c,"throw",n)}i(void 0)}))})()},n}(),l=t(7294),s=t(2734),f=t.n(s),d=t(5152),p=t.n(d),v=t(7979);function h(n,e){(null==e||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function m(n,e,t,r,o,u,i){try{var a=n[u](i),c=a.value}catch(l){return void t(l)}a.done?e(c):Promise.resolve(c).then(r,o)}function w(n){return function(){var e=this,t=arguments;return new Promise((function(r,o){var u=n.apply(e,t);function i(n){m(u,r,o,i,a,"next",n)}function a(n){m(u,r,o,i,a,"throw",n)}i(void 0)}))}}function y(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=null==n?null:"undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=t){var r,o,u=[],i=!0,a=!1;try{for(t=t.call(n);!(i=(r=t.next()).done)&&(u.push(r.value),!e||u.length!==e);i=!0);}catch(c){a=!0,o=c}finally{try{i||null==t.return||t.return()}finally{if(a)throw o}}return u}}(n,e)||k(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(n){return function(n){if(Array.isArray(n))return h(n)}(n)||function(n){if("undefined"!==typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||k(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(n,e){if(n){if("string"===typeof n)return h(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);return"Object"===t&&n.constructor&&(t=n.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?h(n,e):void 0}}var g=p()((function(){return Promise.all([t.e(6),t.e(972)]).then(t.bind(t,6972)).then((function(n){return n.PlotLatentSketch}))}),{loadableGenerated:{webpack:function(){return[6972]}},ssr:!1}),x=2/21,A=function(n){var e=n.audioFilePath,t=n.visualizerConfig,r=n.title,a=y(l.useState(null),2),s=a[0],d=a[1];l.useEffect((function(){if(null===s){window.AudioContext=window.AudioContext||window.webkitAudioContext;var n=new AudioContext;d(n)}}),[]);var p=l.useRef(null),h=y(l.useState(null),2),m=h[0],k=h[1];l.useEffect((function(){if(null!==s&&null!==p.current&&null===m){var n=p.current,e=s.createMediaElementSource(n);k(e)}}),[s]);var A=y(l.useState(null),2),S=A[0],_=A[1];l.useEffect((function(){if(null!==s&&null===S){var n=function(){var n=w(o().mark((function n(){var e;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,s.audioWorklet.addModule("LONG_FAST"===t.mode?(0,v.H)("/worklet-scripts/resample_mel.worklet.js"):(0,v.H)("/worklet-scripts/resample.worklet.js"));case 2:e=new AudioWorkletNode(s,"LONG_FAST"===t.mode?"resample-mel.worklet":"resample.worklet",{parameterData:{bufferSize:t.frameLength,resampleRate:t.samplingRate}}),_(e);case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}}),[s,t]),l.useEffect((function(){null!==s&&null!==m&&null!==S&&m.connect(S).connect(s.destination)}),[s,m,S]);var E=y(l.useState(null),2),j=E[0],C=E[1],P=y(l.useState(null),2),I=P[0],N=P[1];l.useEffect((function(){var n=function(){var n=w(o().mark((function n(){var e,r;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.YLj((0,v.H)(t.encoderJSONPath));case 2:e=n.sent,r=new c(t.isFlipped,e,t.encoderPreprocessor,N),C(r);case 5:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();n()}),[t]),l.useEffect((function(){null!==S&&null!==j&&(S.port.onmessage=function(){var n=w(o().mark((function n(e){return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:j.encodeAudio(e.data);case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}),[S,j]);var L=y(l.useState([]),2),R=L[0],z=L[1],F=y(l.useState(null),2),H=F[0],O=F[1];l.useEffect((function(){if(null!==I){var n=b(R).concat([I]),e=n.length<=20?n:n.slice(1);z(e)}}),[I]),l.useEffect((function(){var n=R.length;if(0!==n){var e=R[n-1];if(null===H||n<20){for(var t=[],r=0;r<e.coord.length;r++){for(var o=0,u=0;u<n;u++)o+=R[u].coord[r];t.push(o/n)}O({coord:t})}else{var i=H.coord.map((function(n,t){return n*(1-x)+e.coord[t]*x}));O({coord:i})}}}),[R]);var T=l.useCallback((function(){null!==s&&"running"!==s.state&&s.resume()}),[s]),V=l.useCallback((function(){null!==s&&"suspended"!==s.state&&s.suspend()}),[s]);return(0,u.jsxs)("div",{className:f().container,children:[r&&(0,u.jsx)("h4",{className:f().title,children:r}),(0,u.jsx)("audio",{src:(0,v.H)(e),controls:!0,loop:!0,ref:p,onClick:T,onPlay:T,onPause:V}),(0,u.jsxs)("p",{children:["first: ",null===H||void 0===H?void 0:H.coord[0]]}),(0,u.jsxs)("p",{children:["second: ",null===H||void 0===H?void 0:H.coord[1]]}),(0,u.jsx)(g,{canvasWidth:500,canvasHeight:500,encodeResult:H,latentImgInfo:t.latentImgInfo,className:f().sketch__container})]})}},7979:function(n,e,t){"use strict";t.d(e,{H:function(){return o}});var r=t(1752);function o(n){return(0,r.default)().publicRuntimeConfig.urlPrefix+n}},2734:function(n){n.exports={container:"VisualizeAudio_container__kpLYR",title:"VisualizeAudio_title__1xpJg",sketch__container:"VisualizeAudio_sketch__container__EJsRg"}}}]);