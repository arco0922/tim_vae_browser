(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[144],{9996:function(n,t,r){"use strict";r.r(t),r.d(t,{VisualizeAudio:function(){return C}});var e=r(4051),o=r.n(e),a=r(5893),u=r(2230),i=r(7979);function c(n,t){(null==t||t>n.length)&&(t=n.length);for(var r=0,e=new Array(t);r<t;r++)e[r]=n[r];return e}function l(n,t,r,e,o,a,u){try{var i=n[a](u),c=i.value}catch(l){return void r(l)}i.done?t(c):Promise.resolve(c).then(e,o)}function s(n){return function(){var t=this,r=arguments;return new Promise((function(e,o){var a=n.apply(t,r);function u(n){l(a,e,o,u,i,"next",n)}function i(n){l(a,e,o,u,i,"throw",n)}u(void 0)}))}}function f(n){return function(n){if(Array.isArray(n))return c(n)}(n)||function(n){if("undefined"!==typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||function(n,t){if(!n)return;if("string"===typeof n)return c(n,t);var r=Object.prototype.toString.call(n).slice(8,-1);"Object"===r&&n.constructor&&(r=n.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(n,t)}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var d=1024,p=function(){function n(t,r,e,o){!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.running=!1,this.result=null,this.callback=void 0,this.audioContext=t,this.stream=r,this.encoder=e,this.resampleProcesser=null,o&&(this.callback=o)}var t=n.prototype;return t.start=function(){var n=this;return s(o().mark((function t(){var r;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.audioContext.createMediaStreamSource(n.stream),t.next=3,n.audioContext.audioWorklet.addModule((0,i.H)("/worklet-scripts/resample.worklet.js"));case 3:n.resampleProcesser=new AudioWorkletNode(n.audioContext,"resample.worklet"),r.connect(n.resampleProcesser).connect(n.audioContext.destination),n.resampleProcesser.port.onmessage=function(){var t=s(o().mark((function t(r){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.running){t.next=2;break}return t.abrupt("return");case 2:n.encodeAudio(r.data);case 3:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}();case 6:case"end":return t.stop()}}),t)})))()},t.encodeAudio=function(n){var t=this;return s(o().mark((function r(){var e,a,i;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.running=!0,r.next=4,u.glt();case 4:if(i=Array.from(n),!(Math.max((e=Math).max.apply(e,f(i)),-(a=Math).min.apply(a,f(i)))<.01)){r.next=9;break}return t.running=!1,r.abrupt("return");case 9:return u.lub((function(){var r=u.RRF(n),e=u.J69(r),o=u.VV$(r),a=u.Fp7(r),i=u.IHx(u.hiC(u.luU(a,o),u.iD$(2)),u.iD$(1e-5)),c=u.hiC(u.luU(r,e),i),l=u.tdS.stft(c,d,1),s=u.XLQ(l,[513]),f=u.hiC(u.WnP(s),u.iD$(d)),p=u.tPi(f,1,512),h=u.XLQ(p,[1,32,16,1]),v=t.encoder.predict([h]),m=u.XLQ(v[1],[2]),y=Array.from(m.dataSync());t.result={coord:y},t.callback&&t.callback({coord:y})})),t.running=!1,r.next=13,u.glt();case 13:case"end":return r.stop()}}),r)})))()},n}(),h=r(7294),v=r(2734),m=r.n(v),y=r(5152);function b(n,t){(null==t||t>n.length)&&(t=n.length);for(var r=0,e=new Array(t);r<t;r++)e[r]=n[r];return e}function w(n,t,r,e,o,a,u){try{var i=n[a](u),c=i.value}catch(l){return void r(l)}i.done?t(c):Promise.resolve(c).then(e,o)}function x(n,t){return function(n){if(Array.isArray(n))return n}(n)||function(n,t){var r=null==n?null:"undefined"!==typeof Symbol&&n[Symbol.iterator]||n["@@iterator"];if(null!=r){var e,o,a=[],u=!0,i=!1;try{for(r=r.call(n);!(u=(e=r.next()).done)&&(a.push(e.value),!t||a.length!==t);u=!0);}catch(c){i=!0,o=c}finally{try{u||null==r.return||r.return()}finally{if(i)throw o}}return a}}(n,t)||k(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(n){return function(n){if(Array.isArray(n))return b(n)}(n)||function(n){if("undefined"!==typeof Symbol&&null!=n[Symbol.iterator]||null!=n["@@iterator"])return Array.from(n)}(n)||k(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(n,t){if(n){if("string"===typeof n)return b(n,t);var r=Object.prototype.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?b(n,t):void 0}}var A=r.n(y)()((function(){return Promise.all([r.e(6),r.e(972)]).then(r.bind(r,6972)).then((function(n){return n.PlotLatentSketch}))}),{loadableGenerated:{webpack:function(){return[6972]}},ssr:!1}),g=2/11,C=function(n){var t=n.audioFilePath,r=n.encoderJSONPath,e=n.title,c=x(h.useState(null),2),l=c[0],s=c[1],f=h.useRef(null),d=x(h.useState(null),2),v=d[0],y=d[1];h.useEffect((function(){if(null===l){window.AudioContext=window.AudioContext||window.webkitAudioContext;var n=new AudioContext;n.suspend(),s(n)}}),[l]),h.useEffect((function(){if(null!==l&&null!==f.current){var n=f.current,t=n.captureStream?n.captureStream():n.mozCaptureStream?n.mozCaptureStream():null;y(t)}}),[l]);var b=x(h.useState(null),2),k=b[0],C=b[1],_=x(h.useState(null),2),P=_[0],j=_[1],E=x(h.useState([]),2),I=E[0],M=E[1],L=x(h.useState(null),2),N=L[0],R=L[1];h.useEffect((function(){if(null!==l&&null!==v&&null===k){var n=function(){var n,t=(n=o().mark((function n(){var t,e;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u.YLj((0,i.H)(r));case 2:t=n.sent,e=new p(l,v,t,j),C(e);case 5:case"end":return n.stop()}}),n)})),function(){var t=this,r=arguments;return new Promise((function(e,o){var a=n.apply(t,r);function u(n){w(a,e,o,u,i,"next",n)}function i(n){w(a,e,o,u,i,"throw",n)}u(void 0)}))});return function(){return t.apply(this,arguments)}}();n()}}),[k,l,v]),h.useEffect((function(){if(null!==P){var n=S(I).concat([P]),t=n.length<=10?n:n.slice(1);M(t)}}),[P]),h.useEffect((function(){var n=I.length;if(0!==n){var t=I[n-1];if(null===N||n<10){for(var r=[],e=0;e<t.coord.length;e++){for(var o=0,a=0;a<n;a++)o+=I[a].coord[e];r.push(o/n)}R({coord:r})}else{var u=N.coord.map((function(n,r){return n*(1-g)+t.coord[r]*g}));R({coord:u})}}}),[I]);var z=x(h.useState(!1),2),H=z[0],V=z[1],$=h.useCallback((function(){H||V(!0)}),[H]),O=x(h.useState(!1),2),J=O[0],T=O[1];h.useEffect((function(){null!==k&&H&&!J&&(k.start(),T(!0))}),[k,H,J]);var U=h.useCallback((function(){null!==l&&l.resume()}),[l]),W=h.useCallback((function(){null!==l&&l.suspend()}),[l]);return(0,a.jsxs)("div",{className:m().container,children:[e&&(0,a.jsx)("h4",{className:m().title,children:e}),(0,a.jsx)("audio",{src:(0,i.H)(t),controls:!0,loop:!0,ref:f,onLoadedMetadata:$,onPlay:U,onPause:W}),(0,a.jsxs)("p",{children:["first: ",null===N||void 0===N?void 0:N.coord[0]]}),(0,a.jsxs)("p",{children:["second: ",null===N||void 0===N?void 0:N.coord[1]]}),(0,a.jsx)(A,{canvasWidth:500,canvasHeight:500,encodeResult:N,className:m().sketch__container})]})}},7979:function(n,t,r){"use strict";r.d(t,{H:function(){return o}});var e=r(1752);function o(n){return(0,e.default)().publicRuntimeConfig.urlPrefix+n}},2734:function(n){n.exports={container:"VisualizeAudio_container__kpLYR",title:"VisualizeAudio_title__1xpJg",sketch__container:"VisualizeAudio_sketch__container__EJsRg"}},5410:function(){},8628:function(){},1601:function(){},7792:function(){},4977:function(){},5042:function(){}}]);